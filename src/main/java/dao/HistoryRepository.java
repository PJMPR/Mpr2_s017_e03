package dao;

import dao.mappers.IMapResultSetIntoEntity;
import dao.repositories.IHistoryRepository;
import dao.uow.IUnitOfWork;
import domain.model.History;
import domain.model.Operation;
import domain.model.Wallet;

import java.sql.Connection;
import java.sql.SQLException;
import java.util.Date;
import java.util.List;

public class HistoryRepository extends RepositoryBase<History>
implements IHistoryRepository{


    public HistoryRepository(Connection connection,
			IMapResultSetIntoEntity<History> mapper, IUnitOfWork uow) {
        super(connection, mapper, uow);

    }

    @Override
    protected String createTableSql() {
        return "" + "CREATE TABLE history("
                + "id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY ,"
                + "date DATE,"
                + "amount DECIMAL,"
                + "rate DOUBLE,"
                + "FROM_ID int,"
                + "TO_ID int,"
                + "FOREIGN KEY (FROM_ID) REFERENCES wallet(id),"
                + "FOREIGN KEY (TO_ID) REFERENCES wallet(id)"
                + ")";
    }

    @Override
    protected String tableName() {
        return "History";

    }

    @Override
    protected String insertSql() {
        return "INSERT INTO history("
                + "date, "
                + "amount, "
                + "rate,"
                + " FROM_ID,"
                + " TO_ID"
                + ") VALUES (?,?,?,?,?)";
    }

    @Override
    protected String updateSql() {
        return "UPDATE HISTORY SET ("
        		+ "date, "
        		+ "amount, "
        		+ "rate, "
        		+ "FROM_ID" +
                ", TO_ID )= (?,?,?,?,?) WHERE id = ?";
    }

    @Override
    protected void setUpdate(History history) throws SQLException {
        update.setDate(1, history.getDate());
        update.setDouble(2, history.getAmount());
        update.setDouble(3, history.getRate());
        update.setInt(4, history.getFrom().getId());
        update.setInt(5, history.getTo().getId());
        update.setInt(6, history.getId());

    }

    @Override
    protected void setInsert(History history) throws SQLException {
        insert.setDate(1, history.getDate());
        insert.setDouble(2, history.getAmount());
        insert.setDouble(3, history.getRate());
        insert.setInt(4, history.getFrom().getId());
        insert.setInt(5, history.getTo().getId());
    }

	public List<History> of(Wallet wallet) {
		// TODO Auto-generated method stub
		return null;
	}

	public List<History> ofType(Operation operation) {
		// TODO Auto-generated method stub
		return null;
	}

	public List<History> withDate(Date from, Date to) {
		// TODO Auto-generated method stub
		return null;
	}
}
